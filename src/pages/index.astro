---
import Layout from "../layouts/Layout.astro";
import Hotspot from "../components/Hotspot.astro";
import Overlay from "../components/Overlay.astro";

import ProjectsContent from "../components/panels/ProjectsContent.astro";
import AboutContent from "../components/panels/AboutContent.astro";
import ContactContent from "../components/panels/ContactContent.astro";
import TodoContent from "../components/panels/TodoContent.astro";
---

<Layout title="Sehaz at desk">
	<div
		class="relative flex-1 w-full min-h-[60vh] md:h-full overflow-hidden"
		id="desk-container"
	>
		<!-- Desktop Corner UI Overlays (Editorial Brutalism) -->
		<div
			id="ui-overlay"
			class="hidden md:block fixed inset-0 pointer-events-none z-30 p-10 text-primary opacity-0 animate-[fadeIn_1s_ease-out_forwards] animation-delay-500"
			style="transition: color 2000ms cubic-bezier(0.45,0.05,0.55,0.95), opacity 1600ms ease;"
		>
			<!-- Bottom Area Wrapper -->
			<div
				class="absolute bottom-10 left-10 right-10 flex justify-between items-end pointer-events-auto"
			>
				<!-- Bottom Left: Info -->
				<div
					id="left-text"
					class="space-y-3"
					style="transition: opacity 1600ms ease;"
				>
					<div
						class="flex items-center gap-3 text-[12px] font-medium tracking-widest opacity-80"
					>
						<span
							class="w-1.5 h-1.5 rounded-full bg-accent animate-pulse"
						></span>
						<p>Explore the desk. Objects are interactive.</p>
					</div>
					<div class="text-[12px] font-medium opacity-40 pt-1">
						<p>
							&copy; {new Date().getFullYear()} Sehaz &mdash; Chandigarh,
							IN
						</p>
					</div>
				</div>

				<!-- Bottom Right: Name Plate -->
				<div
					id="name-plate"
					class="name-plate text-right flex flex-col items-end cursor-crosshair drop-shadow-sm pointer-events-auto"
					style="transition: opacity 1600ms ease;"
				>
					<h1
						id="name-heading"
						class="font-serif relative text-[64px] sm:text-[90px] font-normal leading-[1.1] tracking-normal grid justify-items-end items-end h-[75px] sm:h-[105px] overflow-hidden text-[#1C1917]"
						style="transition: color 2000ms cubic-bezier(0.45,0.05,0.55,0.95);"
					>
						<span class="name-primary col-start-1 row-start-1"
							>Sehaz</span
						>
						<span
							class="name-secondary col-start-1 row-start-1 text-[#8B0000] whitespace-nowrap"
							>Sehajveer Singh</span
						>
					</h1>
					<p
						id="role-badge"
						class="text-[12px] uppercase tracking-[0.3em] font-medium mt-4 border border-stone-200 text-secondary px-4 py-2 rounded-full"
						style="transition: border-color 2000ms cubic-bezier(0.45,0.05,0.55,0.95), color 2000ms cubic-bezier(0.45,0.05,0.55,0.95);"
					>
						Full-Stack Developer
					</p>
				</div>
			</div>
		</div>

		<!-- Hotspots & Desk Image Parent container -->
		<!-- We bind the zoom scale to this div, so both the image AND the hotspots scale together flawlessly -->
		<!-- Day/Night layered background -->
		<div
			id="desk-background"
			class="hidden md:block fixed inset-0 z-0 opacity-0 animate-[fadeInOpacity_1.5s_ease-out_forwards] transition-all duration-[1200ms] ease-[cubic-bezier(0.16,1,0.3,1)]"
			style="background-color: #E2D9CE; filter: brightness(1); transition: transform 1000ms cubic-bezier(0.16,1,0.3,1), transform-origin 1000ms cubic-bezier(0.16,1,0.3,1), filter 2000ms cubic-bezier(0.45,0.05,0.55,0.95);"
		>
			<!-- Day image (always visible base) -->
			<div
				id="desk-day"
				class="absolute inset-0 bg-cover bg-center bg-no-repeat transition-opacity duration-[2000ms] ease-[cubic-bezier(0.4,0,0.2,1)]"
				style="background-image: url('/desk.png');"
			>
			</div>
			<!-- Night image (fades in on top) -->
			<div
				id="desk-night"
				class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-0 transition-opacity duration-[2000ms] ease-[cubic-bezier(0.45,0.05,0.55,0.95)]"
				style="background-image: url('/desk-night.png');"
			>
			</div>

			<div class="w-full h-full relative">
				<!-- Laptop -> Projects -->
				<Hotspot
					id="hotspot-laptop"
					targetPanel="panel-projects"
					top="33%"
					left="38%"
					width="24%"
					height="24%"
				/>

				<!-- Notebook -> About -->
				<Hotspot
					id="hotspot-notebook"
					targetPanel="panel-about"
					top="48%"
					left="9%"
					width="23%"
					height="3.5%"
				/>
				<!-- Phone -> Contact -->
				<Hotspot
					id="hotspot-phone"
					targetPanel="panel-contact"
					top="65%"
					left="25%"
					width="8%"
					height="20%"
					indicatorColor="bg-white"
				/>

				<!-- Todo Note -> Working On -->
				<Hotspot
					id="hotspot-todo"
					targetPanel="panel-todo"
					top="35%"
					left="64%"
					width="6%"
					height="11%"
				/>

				<!-- Keyboard -> Easter Egg -->
				<Hotspot
					id="hotspot-keyboard"
					targetPanel="panel-fun-keyboard"
					top="67%"
					left="37%"
					width="25%"
					height="15%"
				/>

				<!-- Mouse -> Easter Egg -->
				<Hotspot
					id="hotspot-mouse"
					targetPanel="panel-fun-mouse"
					top="67%"
					left="67%"
					width="5%"
					height="14%"
				/>

				<!-- Headphones -> Easter Egg -->
				<Hotspot
					id="hotspot-headphones"
					targetPanel="panel-fun-headphones"
					top="17%"
					left="75%"
					width="15%"
					height="27%"
				/>

				<!-- Coffee Mug -> Easter Egg -->
				<Hotspot
					id="hotspot-mug"
					targetPanel="panel-fun-mug"
					top="57%"
					left="76%"
					width="7%"
					height="13%"
				/>

				<!-- Lamp -> Night Mode Toggle -->
				<button
					id="hotspot-lamp"
					class="desk-hotspot absolute z-20 cursor-pointer group pointer-events-auto flex items-center justify-center opacity-0 animate-[fadeIn_1s_ease-out_forwards] animation-delay-700"
					style="top: 2%; left: 2%; width: 16%; height: 28%;"
					aria-label="Toggle night mode"
					aria-pressed="false"
				>
					<div
						class="relative flex items-center justify-center w-6 h-6 transition-transform duration-500 ease-[cubic-bezier(0.19,1,0.22,1)] group-hover:scale-150"
					>
						<span
							id="lamp-ring"
							class="absolute inline-flex w-full h-full rounded-full border border-black/20 group-hover:border-black/50 transition-colors duration-500"
						></span>
						<span
							id="lamp-dot"
							class="relative inline-flex w-1.5 h-1.5 rounded-full bg-black/40 group-hover:bg-black/80 transition-colors duration-500"
						></span>
					</div>
				</button>
			</div>
		</div>

		<!-- Mobile Fallback Content (shows static lists instead of overlay map) -->
		<div class="md:hidden p-8 space-y-12 pb-24">
			<div id="mobile-projects" class="space-y-6">
				<h2
					class="text-[24px] font-serif font-medium tracking-tight border-b border-black/10 pb-4"
				>
					Selected Work
				</h2>
				<div class="space-y-6">
					<div class="group border-b border-black/10 pb-6">
						<div class="flex items-baseline justify-between mb-2">
							<h3 class="font-serif text-[18px] font-medium">
								The Framed Archive
							</h3>
							<a
								href="https://theframedarchive.com"
								class="text-[13px] text-secondary"
								>View &rarr;</a
							>
						</div>
						<p class="text-[16px] text-secondary mb-3">
							A full-scale e-commerce platform for posters. Built
							with a responsive, premium UI/UX.
						</p>
						<div
							class="flex gap-2 text-[12px] text-secondary font-medium"
						>
							<span class="px-2 py-1 bg-black/5 rounded"
								>Next.js</span
							>
							<span class="px-2 py-1 bg-black/5 rounded"
								>Firebase</span
							>
						</div>
					</div>

					<div class="group border-b border-black/10 pb-6">
						<div class="flex items-baseline justify-between mb-2">
							<h3 class="font-serif text-[18px] font-medium">
								Folia
							</h3>
							<a
								href="https://folia-os.vercel.app"
								class="text-[13px] text-secondary"
								>View &rarr;</a
							>
						</div>
						<p class="text-[16px] text-secondary mb-3">
							A "second brain" personal productivity app designed
							for seamless knowledge organization.
						</p>
						<div
							class="flex gap-2 text-[12px] text-secondary font-medium"
						>
							<span class="px-2 py-1 bg-black/5 rounded"
								>Next.js</span
							>
							<span class="px-2 py-1 bg-black/5 rounded"
								>Supabase</span
							>
						</div>
					</div>

					<div class="group border-b border-black/10 pb-6">
						<div class="flex items-baseline justify-between mb-2">
							<h3 class="font-serif text-[18px] font-medium">
								The Open Shelf
							</h3>
							<a
								href="https://the-open-shelf.vercel.app"
								class="text-[13px] text-secondary"
								>View &rarr;</a
							>
						</div>
						<p class="text-[16px] text-secondary mb-3">
							A non-linear reading platform that replaces
							traditional RSS feeds with an infinite spatial
							canvas.
						</p>
						<div
							class="flex gap-2 text-[12px] text-secondary font-medium"
						>
							<span class="px-2 py-1 bg-black/5 rounded"
								>React</span
							>
							<span class="px-2 py-1 bg-black/5 rounded"
								>Spatial API</span
							>
						</div>
					</div>
				</div>
			</div>

			<div id="mobile-about" class="space-y-6">
				<h2
					class="text-[24px] font-serif font-medium tracking-tight border-b border-black/10 pb-4"
				>
					About Me
				</h2>
				<p class="text-[16px] text-secondary leading-relaxed">
					Hi, I'm Sehajveer Singh, a full-stack developer passionate
					about building high-performance, beautiful software. I am
					currently pursuing my Bachelor of Engineering in Computer
					Science at Chitkara University (Expected 2027).
				</p>
			</div>

			<div id="mobile-contact" class="space-y-6">
				<h2
					class="text-[24px] font-serif font-medium tracking-tight border-b border-black/10 pb-4"
				>
					Contact
				</h2>
				<ul class="space-y-4">
					<li>
						<a
							href="mailto:sehajveersingh2005@gmail.com"
							class="text-[16px] font-medium hover:text-accent flex items-center gap-3"
							><span class="w-1.5 h-1.5 rounded-full bg-accent"
							></span> sehajveersingh2005@gmail.com</a
						>
					</li>
					<li>
						<a
							href="https://github.com/SehajveerSingh2005"
							target="_blank"
							class="text-[16px] font-medium hover:text-accent flex items-center gap-3"
							><span class="w-1.5 h-1.5 rounded-full bg-accent"
							></span> GitHub</a
						>
					</li>
					<li>
						<a
							href="#"
							target="_blank"
							class="text-[16px] font-medium hover:text-accent flex items-center gap-3"
							><span class="w-1.5 h-1.5 rounded-full bg-accent"
							></span> LinkedIn</a
						>
					</li>
					<li>
						<span
							class="text-[16px] font-medium flex items-center gap-3 text-secondary"
							><span class="w-1.5 h-1.5 rounded-full bg-accent"
							></span> +91 8360138347</span
						>
					</li>
				</ul>
			</div>
			<div id="mobile-workingon" class="space-y-6">
				<h2
					class="text-[24px] font-serif font-medium tracking-tight border-b border-black/10 pb-4"
				>
					Currently Working On
				</h2>
				<p class="text-[16px] text-secondary leading-relaxed">
					Exploring spatial interfaces, WebGL depth, and brutalist
					performance optimizations.
				</p>
			</div>
		</div>
	</div>

	<!-- Overlays (Hidden on mobile via CSS or handled by JS) -->
	<div class="hidden md:block">
		<!-- Projects / Laptop -->
		<Overlay id="panel-projects">
			<ProjectsContent />
		</Overlay>

		<!-- About / Notebook -->
		<Overlay id="panel-about">
			<AboutContent />
		</Overlay>

		<!-- Contact / Phone -->
		<Overlay id="panel-contact">
			<ContactContent />
		</Overlay>

		<!-- Working On / Todo -->
		<Overlay id="panel-todo">
			<TodoContent />
		</Overlay>

		<!-- Easter Eggs -->
		<Overlay id="panel-fun-keyboard">
			<div class="text-center space-y-4 py-8 max-w-xs mx-auto">
				<div class="text-[48px] mb-6 grayscale opacity-80">‚å®Ô∏è</div>
				<h2 class="text-[20px] font-semibold tracking-tight">
					Clack Clack Clack
				</h2>
				<p class="text-[15px] text-secondary">
					A developer's favorite sound. Stay tuned for an interactive
					typing game.
				</p>
			</div>
		</Overlay>

		<Overlay id="panel-fun-mouse">
			<div class="text-center space-y-4 py-8 max-w-xs mx-auto">
				<div class="text-[48px] mb-6 grayscale opacity-80">üñ±Ô∏è</div>
				<h2 class="text-[20px] font-semibold tracking-tight">
					Precise Tracking
				</h2>
				<p class="text-[15px] text-secondary">
					The unsung hero of desktop navigation.
				</p>
			</div>
		</Overlay>

		<Overlay id="panel-fun-headphones">
			<div class="text-center space-y-4 py-8 max-w-xs mx-auto">
				<div class="text-[48px] mb-6 grayscale opacity-80">üéß</div>
				<h2 class="text-[20px] font-semibold tracking-tight">
					Focus Mode
				</h2>
				<p class="text-[15px] text-secondary">
					Lofi beats to study and relax to. Playlist integration
					coming soon.
				</p>
			</div>
		</Overlay>

		<Overlay id="panel-fun-mug">
			<div class="text-center space-y-4 py-8 max-w-xs mx-auto">
				<div class="text-[48px] mb-6 grayscale opacity-80">‚òï</div>
				<h2 class="text-[20px] font-semibold tracking-tight">
					Fancy a coffee?
				</h2>
				<p class="text-[15px] text-secondary">
					The fuel behind the code. Let's chat.
				</p>
			</div>
		</Overlay>
	</div>

	<script>
		// Centralized overlay and interaction management
		document.addEventListener("DOMContentLoaded", () => {
			const overlays = document.querySelectorAll(".overlay-panel");
			const closeBtns = document.querySelectorAll("[data-close-overlay]");
			const hotspots = document.querySelectorAll(".desk-hotspot");
			const deskBg = document.getElementById("desk-background");

			let activePanelId: string | null = null;

			// ---------- Night mode state ----------
			let isNight = false;
			const nightLayer = document.getElementById(
				"desk-night",
			) as HTMLElement | null;
			const lampBtn = document.getElementById(
				"hotspot-lamp",
			) as HTMLElement | null;
			const lampDot = document.getElementById(
				"lamp-dot",
			) as HTMLElement | null;
			const lampRing = document.getElementById(
				"lamp-ring",
			) as HTMLElement | null;
			const uiOverlay = document.getElementById(
				"ui-overlay",
			) as HTMLElement | null;
			const nameEl = document.getElementById(
				"name-heading",
			) as HTMLElement | null;

			// Base transition string for transform (shared, keep intact)
			const BASE_TRANSITION =
				"transform 1000ms cubic-bezier(0.16,1,0.3,1), transform-origin 1000ms cubic-bezier(0.16,1,0.3,1)";
			const DEFAULT_FILTER_TRANSITION = `${BASE_TRANSITION}, filter 2000ms cubic-bezier(0.45,0.05,0.55,0.95)`;

			// Apply UI-only state (text, badge ‚Äî CSS handles their transitions)
			const applyUIState = (night: boolean) => {
				if (uiOverlay) uiOverlay.style.color = night ? "#e7d5b3" : "";
				if (nameEl) nameEl.style.color = night ? "#e7d5b3" : "";
				const badge = document.getElementById("role-badge");
				if (badge) {
					badge.style.borderColor = night
						? "rgba(231,213,179,0.25)"
						: "";
					badge.style.color = night ? "rgba(231,213,179,0.6)" : "";
				}
				if (lampBtn)
					lampBtn.setAttribute("aria-pressed", String(night));
			};

			// Snap the night layer opacity with no CSS transition (instant)
			const snapNightLayer = (opacity: string) => {
				if (!nightLayer) return;
				nightLayer.style.transition = "none";
				nightLayer.style.opacity = opacity;
				void nightLayer.offsetHeight; // force reflow
				nightLayer.style.transition = ""; // restore
			};

			// Toggle handler ‚Äî 3-phase lamp effect
			const namePlate = document.getElementById(
				"name-plate",
			) as HTMLElement | null;
			const leftText = document.getElementById(
				"left-text",
			) as HTMLElement | null;
			const textEls = [leftText, namePlate];

			// Snap text opacity (no transition ‚Äî instant)
			const snapTextOpacity = (opacity: string) => {
				textEls.forEach((el) => {
					if (!el) return;
					const saved = el.style.transition;
					el.style.transition = "none";
					el.style.opacity = opacity;
					void el.offsetHeight;
					el.style.transition = saved;
				});
			};

			// Fade text with transition
			const fadeTextOpacity = (opacity: string) => {
				textEls.forEach((el) => {
					if (el) el.style.opacity = opacity;
				});
			};

			const toggleNight = () => {
				if (!deskBg) return;
				isNight = !isNight;
				applyUIState(isNight);

				// GPU hint for the duration of the animation
				deskBg.style.willChange = "filter, transform";

				if (isNight) {
					// ‚îÄ‚îÄ Day ‚Üí Night ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
					// Phase 1: night falls ‚Äî dim to near-black + fade text out
					deskBg.style.transition = `${BASE_TRANSITION}, filter 1800ms cubic-bezier(0.4,0,0.6,1)`;
					deskBg.style.filter = "brightness(0.06)";
					fadeTextOpacity("0");

					// 1800ms dim + 250ms hold in darkness = lamp clicks at 2050ms
					setTimeout(() => {
						// Phase 2a: lamp on ‚Äî snap night image in + text back
						snapNightLayer("1");
						snapTextOpacity("1");

						// Phase 2b: instant brightness burst (no transition ‚Äî pure flash)
						deskBg.style.transition = BASE_TRANSITION;
						deskBg.style.filter = "brightness(1.5)";
						void deskBg.offsetHeight; // commit the flash

						// Phase 3: settle to warm lamp level
						requestAnimationFrame(() => {
							requestAnimationFrame(() => {
								deskBg.style.transition = `${BASE_TRANSITION}, filter 700ms cubic-bezier(0.16,1,0.3,1)`;
								deskBg.style.filter = "brightness(0.85)";
								setTimeout(() => {
									deskBg.style.transition =
										DEFAULT_FILTER_TRANSITION;
									deskBg.style.willChange = "auto";
								}, 700);
							});
						});
					}, 2050);
				} else {
					// ‚îÄ‚îÄ Night ‚Üí Day ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
					// Phase 1: lamp off ‚Äî quick dim + fade text out
					deskBg.style.transition = `${BASE_TRANSITION}, filter 500ms cubic-bezier(0.4,0,0.6,1)`;
					deskBg.style.filter = "brightness(0.06)";
					fadeTextOpacity("0");

					setTimeout(() => {
						// Phase 2: instant cut back to day image + text snaps back
						snapNightLayer("0");
						snapTextOpacity("1");

						// Phase 3: sunrise ‚Äî daylight slowly restores
						deskBg.style.transition = `${BASE_TRANSITION}, filter 1800ms cubic-bezier(0.16,1,0.3,1)`;
						deskBg.style.filter = "brightness(1)";
						setTimeout(() => {
							deskBg.style.transition = DEFAULT_FILTER_TRANSITION;
							deskBg.style.willChange = "auto";
						}, 1800);
					}, 500);
				}
			};

			if (lampBtn) {
				lampBtn.addEventListener("click", toggleNight);
			}
			// ---------- End night mode ----------

			// Function to close all overlays
			const closeAllOverlays = () => {
				overlays.forEach((overlay) =>
					overlay.classList.remove("active"),
				);
				activePanelId = null;
				if (deskBg) {
					deskBg.style.transform = "";
				}
			};

			// Function to open specific overlay
			const openOverlay = (
				targetId: string,
				originX?: string,
				originY?: string,
			) => {
				closeAllOverlays();
				const panel = document.getElementById(targetId);
				if (panel) {
					panel.classList.add("active");
					activePanelId = targetId;
					if (deskBg && originX && originY) {
						deskBg.style.transformOrigin = `${originX} ${originY}`;
						deskBg.style.transform = "scale(1.15)";
					}
				}
			};

			// Glide between hotspots: debounce the zoom-out so moving from one
			// hotspot to another just shifts the origin instead of zoom out ‚Üí zoom in
			let leaveTimeout: ReturnType<typeof setTimeout> | null = null;

			// Attach hotspot clicks (exclude lamp which handles its own logic)
			hotspots.forEach((hotspot) => {
				if (hotspot.id === "hotspot-lamp") return;

				hotspot.addEventListener("click", (e) => {
					const el = e.currentTarget as HTMLElement;
					const target = el.getAttribute("data-target");
					const left = el.style.left || "50%";
					const top = el.style.top || "50%";
					if (target) openOverlay(target, left, top);
				});

				hotspot.addEventListener("mouseenter", (e) => {
					if (activePanelId || !deskBg) return;

					// Cancel any pending zoom-out ‚Äî just glide the origin
					if (leaveTimeout) {
						clearTimeout(leaveTimeout);
						leaveTimeout = null;
					}

					const el = e.currentTarget as HTMLElement;
					deskBg.style.transformOrigin = `${el.style.left} ${el.style.top}`;
					deskBg.style.transform = "scale(1.15)";
				});

				hotspot.addEventListener("mouseleave", () => {
					if (!activePanelId && deskBg) {
						leaveTimeout = setTimeout(() => {
							if (!activePanelId && deskBg) {
								deskBg.style.transform = "";
							}
							leaveTimeout = null;
						}, 80);
					}
				});
			});

			// Desktop specific: we can also wire Esc and backdrop clicks
			closeBtns.forEach((btn) => {
				btn.addEventListener("click", closeAllOverlays);
			});

			// Escape key to close
			document.addEventListener("keydown", (e) => {
				if (e.key === "Escape" && activePanelId) {
					closeAllOverlays();
				}
			});
		});
	</script>

	<style>
		/* Name plate slide animation ‚Äî plain CSS, no Tailwind group-hover needed */
		.name-primary {
			transform: translateY(0);
			opacity: 1;
			transition:
				transform 700ms cubic-bezier(0.16, 1, 0.3, 1),
				opacity 700ms cubic-bezier(0.16, 1, 0.3, 1);
		}
		.name-plate:hover .name-primary {
			transform: translateY(-100%);
			opacity: 0;
		}

		.name-secondary {
			transform: translateY(100%);
			opacity: 0;
			transition:
				transform 700ms cubic-bezier(0.16, 1, 0.3, 1),
				opacity 700ms cubic-bezier(0.16, 1, 0.3, 1);
		}
		.name-plate:hover .name-secondary {
			transform: translateY(0);
			opacity: 1;
		}
	</style>
</Layout>
